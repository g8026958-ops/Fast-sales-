<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Al Syed Sales Point - Admin Panel</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

  <style>
    :root {
      --primary:#ff4b9a;      /* Pink */
      --primary-dark:#c2185b; /* Dark Pink */
      --accent:#ffcc00;       /* Gold accent */
      --bg:#f7f7fb;           /* Light background */
      --black:#111111;
      --card-bg:#ffffff;
    }
    body {
      background:var(--bg);
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color:var(--black);
    }

    /* NAVBAR */
    .navbar-gradient {
      background:linear-gradient(135deg, #000000, #ff4b9a);
    }
    .brand {
      font-weight:700;
      font-size:1.4rem;
      letter-spacing:0.5px;
    }

    /* METRICS */
    .metric-card {
      border-radius:16px;
      background:var(--card-bg);
      padding:18px;
      box-shadow:0 10px 25px rgba(0, 0, 0, 0.12);
      transition:0.2s;
      border:0;
    }
    .metric-card:hover {
      transform:translateY(-4px);
      box-shadow:0 16px 35px rgba(0, 0, 0, 0.18);
    }
    .metric-title {
      font-size:0.8rem;
      color:#6c757d;
      text-transform:uppercase;
      letter-spacing:0.06em;
    }
    .metric-value {
      font-size:1.5rem;
      font-weight:700;
      color:var(--black);
    }
    .metric-pill {
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:2px 8px;
      border-radius:999px;
      font-size:0.7rem;
      background:rgba(255,75,154,0.12);
      color:var(--primary-dark);
    }
    .low-stock {
      color:#ff1744;
      font-weight:600;
    }

    /* APP NAV */
    .app-nav {
      background:#000000;
      border-bottom:1px solid #222;
      position:sticky;
      top:0;
      z-index:50;
    }
    .app-nav .nav-link {
      border-radius:999px;
      padding:6px 14px;
      font-size:0.9rem;
      color:#f5f5f5;
      border:0;
    }
    .app-nav .nav-link.active {
      background:linear-gradient(135deg, #ff4b9a, #ffffff);
      color:#000000 !important;
      box-shadow:0 8px 18px rgba(255,75,154,0.45);
    }

    /* PRODUCT CARDS */
    .product-card {
      border-radius:14px;
      padding:12px;
      background:var(--card-bg);
      box-shadow:0 6px 16px rgba(0, 0, 0, 0.12);
      border:0;
    }
    .product-tag {
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:0.7rem;
      background:#ffe4f0;
      color:#ad1457;
    }

    .section-title {
      font-weight:600;
      font-size:1.05rem;
      color:#111827;
    }

    .hidden { display:none !important; }

    /* LOGIN OVERLAY */
    #loginOverlay {
      position:fixed;
      inset:0;
      background:radial-gradient(circle at top, rgba(255,75,154,0.4), rgba(0,0,0,0.95));
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    #loginCard {
      background:#111111;
      border-radius:18px;
      padding:24px 22px;
      width:100%;
      max-width:380px;
      box-shadow:0 20px 45px rgba(0, 0, 0, 0.75);
      color:#ffffff;
    }
    #loginCard h4 { font-weight:700; }
    .login-badge {
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(255,75,154,0.18);
      color:#ff80ab;
      font-size:0.75rem;
    }
    #loginCard .form-label { color:#f5f5f5; }
    #loginCard .form-control {
      background:#1e1e1e;
      border-color:#333;
      color:#ffffff;
    }
    #loginCard .form-control::placeholder {
      color:#777;
    }

    .table thead {
      font-size:0.8rem;
      text-transform:uppercase;
      letter-spacing:0.05em;
      background:#111;
      color:#fff;
    }
    .table td {
      vertical-align:middle;
      font-size:0.9rem;
      background:#ffffff;
    }

    .chip {
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:2px 8px;
      border-radius:999px;
      font-size:0.75rem;
      background:#ffe4f0;
      color:#ad1457;
    }
    .badge-soft {
      background:#ffebee;
      color:#c62828;
      border-radius:999px;
      font-size:0.7rem;
      padding:2px 8px;
    }

    .role-badge {
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:2px 8px;
      border-radius:999px;
      font-size:0.75rem;
      background:#ffe4f0;
      color:#ad1457;
    }

    #bestSellingContainer {
      display:flex;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>

<!-- LOGIN OVERLAY -->
<div id="loginOverlay">
  <div id="loginCard">
    <div class="text-center mb-3">
      <div class="login-badge mb-2">
        <i class="bi bi-gem"></i>
        <span>Cosmetics & Jewelry Admin</span>
      </div>
      <h4>Al Syed Sales Point</h4>
      <p class="text-muted mb-0" style="font-size:0.85rem;color:#cccccc !important;">Admin / Staff Login (Demo)</p>
    </div>
    <div class="mb-3">
      <label class="form-label">Email</label>
      <input id="loginEmail" type="email" class="form-control" placeholder="admin@alsyed.com or staff@alsyed.com">
    </div>
    <div class="mb-3">
      <label class="form-label">Password</label>
      <input id="loginPassword" type="password" class="form-control" placeholder="******">
    </div>
    <button class="btn w-100 mb-2" style="background:linear-gradient(135deg,#ff4b9a,#ffffff);border:0;color:#000;font-weight:600;" onclick="fakeLogin()">
      Sign In
    </button>
    <small class="d-block text-center" style="font-size:0.8rem;color:#bbbbbb;">
      Demo: <b>admin@alsyed.com</b> = Admin, <b>staff@alsyed.com</b> = Staff
    </small>
  </div>
</div>

<!-- NAVBAR -->
<nav class="navbar navbar-gradient px-3">
  <span class="navbar-brand brand text-white d-flex align-items-center gap-2">
    <i class="bi bi-bag-heart-fill"></i>
    <span>Al Syed Sales Point</span>
  </span>
  <span class="text-white d-flex align-items-center gap-2">
    <span class="role-badge">
      <i class="bi bi-person-circle"></i>
      <span id="userRoleLabel">Role</span>
    </span>
    <span id="userName">User</span>
  </span>
</nav>

<!-- APP NAV -->
<div class="app-nav">
  <div class="container">
    <ul class="nav nav-pills py-2 gap-2">
      <li class="nav-item">
        <button class="nav-link active" data-section="dashboard" onclick="showSection(event,'dashboard')">
          <i class="bi bi-speedometer2 me-1"></i>Dashboard
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-section="products" onclick="showSection(event,'products')">
          <i class="bi bi-box-seam me-1"></i>Products
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-section="sales" onclick="showSection(event,'sales')">
          <i class="bi bi-receipt me-1"></i>Sales
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-section="alerts" onclick="showSection(event,'alerts')">
          <i class="bi bi-exclamation-triangle me-1"></i>Stock Alerts
        </button>
      </li>
    </ul>
  </div>
</div>

<div class="container my-4">

  <!-- DASHBOARD SECTION -->
  <div id="section-dashboard">
    <div class="row g-3">
      <div class="col-6 col-md-3">
        <div class="metric-card">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <span class="metric-title">Total Products</span>
            <span class="metric-pill"><i class="bi bi-box"></i> Live</span>
          </div>
          <div class="metric-value" id="metricTotalProducts">0</div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="metric-card">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <span class="metric-title">Total Orders</span>
            <span class="metric-pill"><i class="bi bi-cart-check"></i> All</span>
          </div>
          <div class="metric-value" id="metricTotalOrders">0</div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="metric-card">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <span class="metric-title">Total Sales</span>
            <span class="metric-pill"><i class="bi bi-cash-stack"></i> PKR</span>
          </div>
          <div class="metric-value" id="metricTotalSales">0 PKR</div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="metric-card">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <span class="metric-title">Low Stock</span>
            <span class="metric-pill"><i class="bi bi-bell"></i> Alerts</span>
          </div>
          <div class="metric-value low-stock" id="metricLowStock">0</div>
        </div>
      </div>
    </div>

    <!-- DAILY / WEEKLY / MONTHLY SALES -->
    <div class="row g-3 mt-3">
      <div class="col-md-4 col-12">
        <div class="metric-card">
          <div class="metric-title mb-1">Daily Sales</div>
          <div class="metric-value" id="metricDailySales">0 PKR</div>
        </div>
      </div>
      <div class="col-md-4 col-12">
        <div class="metric-card">
          <div class="metric-title mb-1">Weekly Sales (Last 7 days)</div>
          <div class="metric-value" id="metricWeeklySales">0 PKR</div>
        </div>
      </div>
      <div class="col-md-4 col-12">
        <div class="metric-card">
          <div class="metric-title mb-1">Monthly Sales (Last 30 days)</div>
          <div class="metric-value" id="metricMonthlySales">0 PKR</div>
        </div>
      </div>
    </div>

    <!-- BEST SELLING -->
    <div class="mt-4">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="section-title">Best Selling Items</div>
        <span class="chip"><i class="bi bi-fire"></i> Hot Products</span>
      </div>
      <div class="row g-3" id="bestSellingContainer">
        <!-- JS will fill -->
      </div>
    </div>
  </div>

  <!-- PRODUCTS SECTION -->
  <div id="section-products" class="hidden">
    <div class="section-title mb-2 d-flex justify-content-between align-items-center">
      <span>Products</span>
      <span class="chip"><i class="bi bi-box-seam"></i> Manage Inventory</span>
    </div>

    <!-- Add/Edit Form (Admin only) -->
    <div id="adminProductFormWrapper" class="card mb-3 shadow-sm border-0">
      <div class="card-header bg-dark text-white fw-bold">
        Add / Edit Product (Admin)
      </div>
      <div class="card-body">
        <form class="row g-2" onsubmit="saveProduct(event)">
          <input type="hidden" id="prodId">
          <div class="col-md-3">
            <label class="form-label">Name</label>
            <input id="prodName" type="text" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Category</label>
            <input id="prodCategory" type="text" class="form-control" placeholder="Jewelry / Cosmetics">
          </div>
          <div class="col-md-2">
            <label class="form-label">Purchase</label>
            <input id="prodPurchase" type="number" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Sale</label>
            <input id="prodSale" type="number" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Discount</label>
            <input id="prodDiscount" type="number" class="form-control" placeholder="0">
          </div>
          <div class="col-md-1">
            <label class="form-label">Stock</label>
            <input id="prodStock" type="number" class="form-control" required>
          </div>
          <div class="col-12 mt-2">
            <button class="btn btn-success">
              <i class="bi bi-save me-1"></i>Save Product
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm ms-2" onclick="resetProductForm()">
              Clear
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Staff stock adjust (inventory in/out) -->
    <div id="staffStockAdjustWrapper" class="card mb-3 shadow-sm border-0 hidden">
      <div class="card-header bg-dark text-white fw-bold">
        Inventory In / Out (Staff)
      </div>
      <div class="card-body">
        <form class="row g-2" onsubmit="adjustStock(event)">
          <div class="col-md-6">
            <label class="form-label">Product</label>
            <select id="adjustProduct" class="form-select" required></select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Quantity (+ add / - minus)</label>
            <input id="adjustQuantity" type="number" class="form-control" required>
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-primary w-100" style="background:linear-gradient(135deg,#ff4b9a,#ffffff);border:0;color:#000;">
              <i class="bi bi-arrow-left-right me-1"></i>Update Stock
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Products Table -->
    <div class="card shadow-sm border-0">
      <div class="card-header bg-dark text-white fw-bold d-flex justify-content-between align-items-center">
        <span>All Products</span>
        <span class="text-light" style="font-size:0.8rem;">Purchase / Sale / Discount / Stock / Sold</span>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-bordered table-sm align-middle">
          <thead>
            <tr>
              <th>Product</th>
              <th>Category</th>
              <th>Purchase</th>
              <th>Sale</th>
              <th>Discount</th>
              <th>Stock</th>
              <th>Sold</th>
              <th style="width:130px;">Actions</th>
            </tr>
          </thead>
          <tbody id="productsTableBody">
            <!-- JS will fill -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- SALES SECTION -->
  <div id="section-sales" class="hidden">
    <div class="section-title mb-2 d-flex justify-content-between align-items-center">
      <span>Sales</span>
      <span class="chip"><i class="bi bi-receipt"></i> Record Orders</span>
    </div>

    <!-- Add Sale -->
    <div class="card mb-3 shadow-sm border-0">
      <div class="card-header bg-dark text-white fw-bold">
        Add Sale (Admin + Staff)
      </div>
      <div class="card-body">
        <form class="row g-2" onsubmit="addSale(event)">
          <div class="col-md-6">
            <label class="form-label">Product</label>
            <select id="saleProduct" class="form-select" required>
              <option value="none" selected>Select product</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Quantity</label>
            <input id="saleQuantity" type="number" class="form-control" min="1" required>
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-primary w-100" style="background:linear-gradient(135deg,#ff4b9a,#ffffff);border:0;color:#000;">
              <i class="bi bi-plus-circle me-1"></i>Add Sale
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Sales List -->
    <div class="card shadow-sm border-0">
      <div class="card-header bg-dark text-white fw-bold">
        Recent Sales
      </div>
      <div class="card-body">
        <ul class="list-group" id="salesList">
          <!-- JS will fill -->
        </ul>
      </div>
    </div>
  </div>

  <!-- ALERTS SECTION -->
  <div id="section-alerts" class="hidden">
    <div class="section-title mb-2 d-flex justify-content-between align-items-center">
      <span>Low Stock & Out of Stock</span>
      <span class="chip"><i class="bi bi-bell"></i> Alerts</span>
    </div>
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <ul class="list-group" id="alertsList">
          <!-- JS will fill -->
        </ul>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Demo data with dates
  let products = [
    {id:1, name:"Ruby Necklace", category:"Jewelry", purchase:15000, sale:20000, discount:18000, stock:300, sold:200},
    {id:2, name:"Matte Lipstick", category:"Cosmetics", purchase:300, sale:600, discount:450, stock:80, sold:150},
    {id:3, name:"Jewelry Set", category:"Jewelry", purchase:1200, sale:2400, discount:2000, stock:0, sold:400}
  ];
  let sales = [
    {id:1, productId:1, quantity:2, total:36000, date:new Date()},
    {id:2, productId:2, quantity:5, total:2250, date:new Date()}
  ];
  let nextProductId = 4;
  let nextSaleId = 3;

  let currentRole = "admin"; // "admin" or "staff"

  function fakeLogin() {
    const email = (document.getElementById('loginEmail').value || "").toLowerCase();
    if (email.includes("staff")) {
      currentRole = "staff";
      document.getElementById('userName').innerText = "Staff";
      document.getElementById('userRoleLabel').innerText = "Staff";
    } else {
      currentRole = "admin";
      document.getElementById('userName').innerText = "Admin";
      document.getElementById('userRoleLabel').innerText = "Admin";
    }

    if (currentRole === "admin") {
      document.getElementById('adminProductFormWrapper').classList.remove('hidden');
      document.getElementById('staffStockAdjustWrapper').classList.add('hidden');
    } else {
      document.getElementById('adminProductFormWrapper').classList.add('hidden');
      document.getElementById('staffStockAdjustWrapper').classList.remove('hidden');
    }

    document.getElementById('loginOverlay').style.display = 'none';
    renderAll();
  }

  function showSection(ev, name) {
    const sections = ["dashboard","products","sales","alerts"];
    sections.forEach(s => {
      document.getElementById("section-"+s).classList.add("hidden");
    });
    document.getElementById("section-"+name).classList.remove("hidden");

    document.querySelectorAll(".app-nav .nav-link").forEach(btn => btn.classList.remove("active"));
    if (ev && ev.target) ev.target.classList.add("active");
  }

  function renderAll() {
    renderMetrics();
    renderBestSelling();
    renderProductsTable();
    renderSaleProductOptions();
    renderAdjustProductOptions();
    renderSalesList();
    renderAlerts();
  }

  function renderMetrics() {
    const totalProducts = products.length;
    const totalOrders = sales.length;
    const totalSales = sales.reduce((sum,s) => sum + s.total, 0);
    const lowStockCount = products.filter(p => p.stock <= 5).length;
    const outOfStockCount = products.filter(p => p.stock === 0).length;

    document.getElementById('metricTotalProducts').innerText = totalProducts;
    document.getElementById('metricTotalOrders').innerText = totalOrders;
    document.getElementById('metricTotalSales').innerText = totalSales.toLocaleString() + " PKR";
    document.getElementById('metricLowStock').innerText = lowStockCount;

    const now = new Date();
    const oneDay = 24*60*60*1000;
    let daily = 0, weekly = 0, monthly = 0;

    sales.forEach(s => {
      const diff = (now - s.date) / oneDay;
      if (diff <= 1) daily += s.total;
      if (diff <= 7) weekly += s.total;
      if (diff <= 30) monthly += s.total;
    });

    document.getElementById('metricDailySales').innerText = daily.toLocaleString() + " PKR";
    document.getElementById('metricWeeklySales').innerText = weekly.toLocaleString() + " PKR";
    document.getElementById('metricMonthlySales').innerText = monthly.toLocaleString() + " PKR";

    document.getElementById('todayOutOfStock') && (document.getElementById('todayOutOfStock').innerText = outOfStockCount);
  }

  function renderBestSelling() {
    const container = document.getElementById('bestSellingContainer');
    container.innerHTML = "";
    const sorted = [...products].sort((a,b) => b.sold - a.sold).slice(0,4);
    sorted.forEach(p => {
      const div = document.createElement('div');
      div.className = "col-6 col-md-3";
      div.innerHTML = `
        <div class="product-card text-center">
          <div class="mb-1"><span class="product-tag">${p.category || 'Product'}</span></div>
          <strong>${p.name}</strong><br>
          <small>Sold: ${p.sold}</small>
        </div>`;
      container.appendChild(div);
    });
    setTimeout(() => {
      container.style.display = "flex";
    }, 50);
  }

  function renderProductsTable() {
    const tbody = document.getElementById('productsTableBody');
    tbody.innerHTML = "";
    products.forEach(p => {
      const tr = document.createElement('tr');
      let actions = "";
      if (currentRole === "admin") {
        actions = `
          <button class="btn btn-sm btn-outline-primary me-1" onclick='editProduct(${p.id})'>
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger" onclick='deleteProduct(${p.id})'>
            <i class="bi bi-trash"></i>
          </button>`;
      } else {
        actions = `<span class="text-muted" style="font-size:0.8rem;">View only</span>`;
      }
      tr.innerHTML = `
        <td>${p.name}</td>
        <td>${p.category || ""}</td>
        <td>${p.purchase}</td>
        <td>${p.sale}</td>
        <td>${p.discount || "-"}</td>
        <td class="${p.stock <= 5 ? 'low-stock' : ''}">${p.stock}</td>
        <td>${p.sold}</td>
        <td>${actions}</td>`;
      tbody.appendChild(tr);
    });
  }

  function renderSaleProductOptions() {
    const select = document.getElementById('saleProduct');
    select.innerHTML = `<option value="none">Select product</option>`;
    products.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = `${p.name} (Stock: ${p.stock})`;
      select.appendChild(opt);
    });
  }

  function renderAdjustProductOptions() {
    const select = document.getElementById('adjustProduct');
    if (!select) return;
    select.innerHTML = `<option value="">Select product</option>`;
    products.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = `${p.name} (Stock: ${p.stock})`;
      select.appendChild(opt);
    });
  }

  function renderSalesList() {
    const list = document.getElementById('salesList');
    list.innerHTML = "";
    sales.slice().reverse().forEach(s => {
      const p = products.find(x => x.id === s.productId);
      const li = document.createElement('li');
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      const dateStr = s.date.toLocaleDateString();
      li.innerHTML = `
        <span>${p ? p.name : 'Product'} x ${s.quantity} <small class="text-muted">(${dateStr})</small></span>
        <span>${s.total.toLocaleString()} PKR</span>`;
      list.appendChild(li);
    });
  }

  function renderAlerts() {
    const list = document.getElementById('alertsList');
    list.innerHTML = "";
    const low = products.filter(p => p.stock <= 5);
    if (low.length === 0) {
      const li = document.createElement('li');
      li.className = "list-group-item";
      li.textContent = "No low stock items.";
      list.appendChild(li);
      return;
    }
    low.forEach(p => {
      const li = document.createElement('li');
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      li.innerHTML = `
        <span>${p.name} (${p.category || ''})</span>
        <span class="low-stock">Stock: ${p.stock}</span>`;
      list.appendChild(li);
    });
  }

  function saveProduct(e) {
    e.preventDefault();
    if (currentRole !== "admin") return;

    const id = document.getElementById('prodId').value;
    const name = document.getElementById('prodName').value.trim();
    const category = document.getElementById('prodCategory').value.trim();
    const purchase = Number(document.getElementById('prodPurchase').value);
    const sale = Number(document.getElementById('prodSale').value);
    const discount = Number(document.getElementById('prodDiscount').value || 0);
    const stock = Number(document.getElementById('prodStock').value);

    if (!name) return;

    if (id) {
      const p = products.find(x => x.id == id);
      if (p) {
        p.name = name;
        p.category = category;
        p.purchase = purchase;
        p.sale = sale;
        p.discount = discount;
        p.stock = stock;
      }
    } else {
      products.push({
        id: nextProductId++,
        name, category, purchase, sale, discount, stock, sold:0
      });
    }
    resetProductForm();
    renderAll();
  }

  function resetProductForm() {
    document.getElementById('prodId').value = "";
    document.getElementById('prodName').value = "";
    document.getElementById('prodCategory').value = "";
    document.getElementById('prodPurchase').value = "";
    document.getElementById('prodSale').value = "";
    document.getElementById('prodDiscount').value = "";
    document.getElementById('prodStock').value = "";
  }

  function editProduct(id) {
    if (currentRole !== "admin") return;
    const p = products.find(x => x.id === id);
    if (!p) return;
    document.getElementById('prodId').value = p.id;
    document.getElementById('prodName').value = p.name;
    document.getElementById('prodCategory').value = p.category;
    document.getElementById('prodPurchase').value = p.purchase;
    document.getElementById('prodSale').value = p.sale;
    document.getElementById('prodDiscount').value = p.discount;
    document.getElementById('prodStock').value = p.stock;
    showSection(null,'products');
    document.querySelectorAll(".app-nav .nav-link").forEach(btn => {
      if (btn.dataset.section === 'products') btn.classList.add('active'); else btn.classList.remove('active');
    });
  }

  function deleteProduct(id) {
    if (currentRole !== "admin") return;
    if (!confirm("Delete this product?")) return;
    products = products.filter(p => p.id !== id);
    renderAll();
  }

  function addSale(e) {
    e.preventDefault();
    const prodId = Number(document.getElementById('saleProduct').value);
    const qty = Number(document.getElementById('saleQuantity').value);
    if (!prodId || qty <= 0 || isNaN(qty)) return;

    const p = products.find(x => x.id === prodId);
    if (!p) return;
    if (p.stock < qty) {
      alert("Not enough stock!");
      return;
    }
    const price = p.discount > 0 ? p.discount : p.sale;
    const total = price * qty;

    p.stock -= qty;
    p.sold += qty;
    sales.push({id: nextSaleId++, productId: prodId, quantity: qty, total, date:new Date()});
    document.getElementById('saleQuantity').value = "";
    document.getElementById('saleProduct').value = "none";

    renderAll();
  }

  function adjustStock(e) {
    e.preventDefault();
    if (currentRole !== "staff" && currentRole !== "admin") return;
    const prodId = Number(document.getElementById('adjustProduct').value);
    const qty = Number(document.getElementById('adjustQuantity').value);
    if (!prodId || !qty || isNaN(qty)) return;
    const p = products.find(x => x.id === prodId);
    if (!p) return;
    p.stock += qty;
    document.getElementById('adjustQuantity').value = "";
    document.getElementById('adjustProduct').value = "";
    renderAll();
  }
</script>
</body>
</html>
