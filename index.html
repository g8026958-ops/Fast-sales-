<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Al Syed Sales Point - POS</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

  <style>
    :root {
      --primary:#ff4b9a;
      --primary-dark:#c2185b;
      --accent:#ffcc00;
      --bg:#f7f7fb;
      --black:#111111;
      --card-bg:#ffffff;
    }
    body {
      background:var(--bg);
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color:var(--black);
      padding-bottom:70px;
    }
    .navbar-gradient {
      background:linear-gradient(135deg, #000000, #ff4b9a);
    }
    .brand {
      font-weight:700;
      font-size:1.4rem;
    }
    .metric-card {
      border-radius:16px;
      background:var(--card-bg);
      padding:18px;
      box-shadow:0 10px 25px rgba(0,0,0,.12);
      border:0;
    }
    .metric-title {
      font-size:.8rem;
      color:#6c757d;
      text-transform:uppercase;
    }
    .metric-value {
      font-size:1.5rem;
      font-weight:700;
    }
    .low-stock { color:#ff1744; font-weight:600; }
    .hidden { display:none !important; }

    .app-nav {
      background:#000;
      position:sticky;
      top:0;
      z-index:50;
    }
    .app-nav .nav-link {
      color:#fff;
      border-radius:999px;
      padding:6px 14px;
    }
    .app-nav .nav-link.active {
      background:linear-gradient(135deg,#ff4b9a,#fff);
      color:#000 !important;
    }

    .bottom-nav {
      position:fixed;
      bottom:0; left:0; right:0;
      background:#000;
      border-top:1px solid #222;
      z-index:60;
    }
    .bottom-nav .nav-link {
      color:#f5f5f5;
      font-size:.8rem;
    }
    .bottom-nav .nav-link.active {
      background:linear-gradient(135deg,#ff4b9a,#fff);
      color:#000;
    }

    .fab {
      position:fixed;
      bottom:80px;
      right:16px;
      width:56px;
      height:56px;
      border-radius:50%;
      background:linear-gradient(135deg,#ff4b9a,#fff);
      border:0;
      z-index:70;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginOverlay">
  <div id="loginCard" class="text-white" style="background:#111;border-radius:18px;padding:24px;max-width:380px;margin:auto;">
    <h4 class="text-center">Al Syed Sales Point</h4>
    <div class="mb-2">
      <label>User</label>
      <input id="loginUser" class="form-control" placeholder="admin / staff">
    </div>
    <div class="mb-3">
      <label>Password</label>
      <input id="loginPass" type="password" class="form-control">
    </div>
    <button class="btn w-100" style="background:linear-gradient(135deg,#ff4b9a,#fff)" onclick="login()">Login</button>
  </div>
</div>

<!-- NAVBAR -->
<nav class="navbar navbar-gradient px-3">
  <span class="navbar-brand brand text-white">
    <i class="bi bi-bag-heart-fill"></i> Al Syed Sales Point
  </span>
  <span class="text-white">
    <span id="userRole">Role</span> | <span id="userName">User</span>
  </span>
</nav>

<!-- TOP NAV -->
<div class="app-nav d-none d-md-block">
  <div class="container">
    <ul class="nav nav-pills py-2 gap-2">
      <li class="nav-item"><button class="nav-link active" onclick="showSection('dashboard')">Dashboard</button></li>
      <li class="nav-item"><button class="nav-link" onclick="showSection('products')">Products</button></li>
      <li class="nav-item"><button class="nav-link" onclick="showSection('sales')">Sales</button></li>
      <li class="nav-item"><button class="nav-link" onclick="showSection('orders')">Orders</button></li>
      <li class="nav-item"><button class="nav-link" onclick="showSection('expenses')">Expenses</button></li>
      <li class="nav-item"><button class="nav-link" onclick="showSection('alerts')">Alerts</button></li>
    </ul>
  </div>
</div>

<div class="container my-3">

<!-- DASHBOARD -->
<div id="section-dashboard">
  <div class="row g-3">
    <div class="col-6 col-md-3"><div class="metric-card"><div class="metric-title">Products</div><div class="metric-value" id="mProducts">0</div></div></div>
    <div class="col-6 col-md-3"><div class="metric-card"><div class="metric-title">Orders</div><div class="metric-value" id="mOrders">0</div></div></div>
    <div class="col-6 col-md-3"><div class="metric-card"><div class="metric-title">Sales</div><div class="metric-value" id="mSales">0</div></div></div>
    <div class="col-6 col-md-3"><div class="metric-card"><div class="metric-title">Low Stock</div><div class="metric-value low-stock" id="mLow">0</div></div></div>
  </div>
</div>
<!-- PRODUCTS -->
<div id="section-products" class="hidden">
  <div class="card mb-3">
    <div class="card-header bg-dark text-white">Add / Edit Product</div>
    <div class="card-body">
      <form onsubmit="saveProduct(event)">
        <input type="hidden" id="pId">
        <div class="row g-2">
          <div class="col-md-3">
            <input id="pName" class="form-control" placeholder="Name" required>
          </div>
          <div class="col-md-2">
            <select id="pCat" class="form-select">
              <option>Jewelry</option>
              <option>Cosmetics</option>
              <option>Undergarments</option>
            </select>
          </div>
          <div class="col-md-2">
            <input id="pBuy" type="number" class="form-control" placeholder="Purchase" required>
          </div>
          <div class="col-md-2">
            <input id="pSale" type="number" class="form-control" placeholder="Sale" required>
          </div>
          <div class="col-md-1">
            <input id="pDisc" type="number" class="form-control" placeholder="Disc">
          </div>
          <div class="col-md-2">
            <input id="pStock" type="number" class="form-control" placeholder="Stock" required>
          </div>
        </div>
        <button class="btn btn-success mt-2">Save Product</button>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header bg-dark text-white">All Products</div>
    <div class="card-body table-responsive">
      <table class="table table-bordered table-sm">
        <thead class="table-dark">
          <tr>
            <th>Name</th><th>Category</th><th>Stock</th><th>Sold</th><th>Action</th>
          </tr>
        </thead>
        <tbody id="productsTable"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- SALES -->
<div id="section-sales" class="hidden">
  <div class="card mb-3">
    <div class="card-header bg-dark text-white">Add to Cart</div>
    <div class="card-body">
      <form onsubmit="addToCart(event)">
        <div class="row g-2">
          <div class="col-md-6">
            <select id="cartProduct" class="form-select"></select>
          </div>
          <div class="col-md-3">
            <input id="cartQty" type="number" class="form-control" placeholder="Qty" min="1" required>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100">Add</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header bg-dark text-white">Cart</div>
    <div class="card-body table-responsive">
      <table class="table table-sm">
        <thead>
          <tr><th>Product</th><th>Qty</th><th>Total</th><th></th></tr>
        </thead>
        <tbody id="cartTable"></tbody>
      </table>
      <div class="text-end fw-bold" id="cartTotal">Total: 0</div>
      <button class="btn btn-success mt-2" onclick="checkout()">Checkout</button>
    </div>
  </div>
</div>

<!-- ORDERS -->
<div id="section-orders" class="hidden">
  <div class="card">
    <div class="card-header bg-dark text-white">Orders</div>
    <div class="card-body table-responsive">
      <table class="table table-sm table-bordered">
        <thead class="table-dark">
          <tr><th>#</th><th>Total</th><th>Status</th><th>Date</th></tr>
        </thead>
        <tbody id="ordersTable"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- EXPENSES -->
<div id="section-expenses" class="hidden">
  <div class="card mb-3">
    <div class="card-header bg-dark text-white">Add Expense</div>
    <div class="card-body">
      <form onsubmit="addExpense(event)">
        <div class="row g-2">
          <div class="col-md-4"><input id="eTitle" class="form-control" placeholder="Title" required></div>
          <div class="col-md-4"><input id="eAmt" type="number" class="form-control" placeholder="Amount" required></div>
          <div class="col-md-4"><button class="btn btn-primary w-100">Add</button></div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ALERTS -->
<div id="section-alerts" class="hidden">
  <div class="card">
    <div class="card-header bg-dark text-white">Low Stock Alerts</div>
    <div class="card-body">
      <ul id="alertsList" class="list-group"></ul>
    </div>
  </div>
</div>
</div> <!-- container end -->

<!-- BOTTOM NAV (MOBILE) -->
<nav class="bottom-nav d-md-none">
  <ul class="nav nav-justified">
    <li class="nav-item"><button class="nav-link active" onclick="showSection('dashboard')">Home</button></li>
    <li class="nav-item"><button class="nav-link" onclick="showSection('products')">Products</button></li>
    <li class="nav-item"><button class="nav-link" onclick="showSection('sales')">Cart</button></li>
    <li class="nav-item"><button class="nav-link" onclick="showSection('orders')">Orders</button></li>
    <li class="nav-item"><button class="nav-link" onclick="showSection('alerts')">Alerts</button></li>
  </ul>
</nav>

<!-- FAB -->
<button class="fab d-md-none" onclick="showSection('products')">
  <i class="bi bi-plus-lg"></i>
</button>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ===============================
   CORE STATE + LOCAL STORAGE
================================ */
const STORAGE_KEY = "alsyed_pos_final_v1";

let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
  products: [],
  sales: [],
  orders: [],
  expenses: [],
  cart: [],
  counters: {
    dailySales: 0,
    dailyProfit: 0,
    monthlySales: 0,
    monthlyProfit: 0
  },
  meta: {
    lastDay: new Date().toDateString()
  }
};

let currentRole = "admin";
let currentUser = "Admin";

/* ===============================
   DAILY AUTO RESET
================================ */
const today = new Date().toDateString();
if (state.meta.lastDay !== today) {
  state.sales = [];
  state.expenses = [];
  state.counters.dailySales = 0;
  state.counters.dailyProfit = 0;
  state.meta.lastDay = today;
  saveState();
}

/* ===============================
   AUTH
================================ */
function login() {
  const u = loginUser.value.toLowerCase();
  const p = loginPass.value.toLowerCase();
  if ((u === "admin" && p === "admin") || (u === "staff" && p === "staff")) {
    currentRole = u;
    currentUser = u === "admin" ? "Admin" : "Staff";
    userRole.innerText = currentRole;
    userName.innerText = currentUser;
    loginOverlay.style.display = "none";
    renderAll();
  } else {
    alert("Wrong login");
  }
}

/* ===============================
   NAV
================================ */
function showSection(name) {
  ["dashboard","products","sales","orders","expenses","alerts"].forEach(s=>{
    document.getElementById("section-"+s)?.classList.add("hidden");
  });
  document.getElementById("section-"+name)?.classList.remove("hidden");
}

/* ===============================
   SAVE / LOAD
================================ */
function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* ===============================
   RENDER ALL
================================ */
function renderAll() {
  renderDashboard();
  renderProducts();
  renderCart();
  renderOrders();
  renderAlerts();
  saveState();
}

/* ===============================
   DASHBOARD
================================ */
function renderDashboard() {
  mProducts.innerText = state.products.length;
  mOrders.innerText = state.orders.length;
  mSales.innerText = state.sales.reduce((s,x)=>s+x.total,0);
  mLow.innerText = state.products.filter(p=>p.stock<=5).length;
}

/* ===============================
   PRODUCTS
================================ */
function renderProducts() {
  productsTable.innerHTML = "";
  cartProduct.innerHTML = "";
  state.products.forEach(p=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>${p.stock}</td>
      <td>${p.sold}</td>
      <td>
        ${currentRole==="admin"
          ? `<button class="btn btn-sm btn-danger" onclick="delProduct(${p.id})">X</button>`
          : ""}
      </td>`;
    productsTable.appendChild(tr);

    const opt = document.createElement("option");
    opt.value = p.id;
    opt.textContent = `${p.name} (${p.stock})`;
    cartProduct.appendChild(opt);
  });
}

function saveProduct(e) {
  e.preventDefault();
  const p = {
    id: Date.now(),
    name:pName.value,
    category:pCat.value,
    purchase:+pBuy.value,
    sale:+pSale.value,
    discount:+pDisc.value||0,
    stock:+pStock.value,
    sold:0
  };
  state.products.push(p);
  e.target.reset();
  renderAll();
}

function delProduct(id) {
  state.products = state.products.filter(p=>p.id!==id);
  renderAll();
}

/* ===============================
   CART + SALES
================================ */
function addToCart(e) {
  e.preventDefault();
  const pid = +cartProduct.value;
  const qty = +cartQty.value;
  const p = state.products.find(x=>x.id===pid);
  if (!p || p.stock < qty) return alert("Stock low");
  state.cart.push({pid,qty});
  cartQty.value="";
  renderCart();
}

function renderCart() {
  cartTable.innerHTML="";
  let total=0;
  state.cart.forEach((c,i)=>{
    const p = state.products.find(x=>x.id===c.pid);
    const price = p.discount||p.sale;
    const line = price*c.qty;
    total+=line;
    cartTable.innerHTML+=`
      <tr>
        <td>${p.name}</td>
        <td>${c.qty}</td>
        <td>${line}</td>
        <td><button class="btn btn-sm btn-danger" onclick="remCart(${i})">X</button></td>
      </tr>`;
  });
  cartTotal.innerText="Total: "+total;
}

function remCart(i){
  state.cart.splice(i,1);
  renderCart();
}

function checkout(){
  if(!state.cart.length) return;
  let total=0;
  state.cart.forEach(c=>{
    const p=state.products.find(x=>x.id===c.pid);
    const price=p.discount||p.sale;
    total+=price*c.qty;
    p.stock-=c.qty;
    p.sold+=c.qty;
    state.sales.push({total, date:new Date()});
  });
  state.orders.push({id:Date.now(), total, status:"Paid", date:new Date()});
  state.cart=[];
  renderAll();
}

/* ===============================
   ORDERS
================================ */
function renderOrders(){
  ordersTable.innerHTML="";
  state.orders.forEach(o=>{
    ordersTable.innerHTML+=`
      <tr>
        <td>${o.id}</td>
        <td>${o.total}</td>
        <td>${o.status}</td>
        <td>${new Date(o.date).toLocaleString()}</td>
      </tr>`;
  });
}

/* ===============================
   EXPENSES
================================ */
function addExpense(e){
  e.preventDefault();
  state.expenses.push({
    id:Date.now(),
    title:eTitle.value,
    amount:+eAmt.value,
    date:new Date()
  });
  e.target.reset();
  renderAll();
}

/* ===============================
   ALERTS
================================ */
function renderAlerts(){
  alertsList.innerHTML="";
  const low = state.products.filter(p=>p.stock<=5);
  if(!low.length){
    alertsList.innerHTML="<li class='list-group-item'>No alerts</li>";
    return;
  }
  low.forEach(p=>{
    alertsList.innerHTML+=`
      <li class="list-group-item d-flex justify-content-between">
        ${p.name}<span class="low-stock">${p.stock}</span>
      </li>`;
  });
}
</script>
<script>
/* ===============================
   RESET TODAY (DASHBOARD)
================================ */
function resetToday() {
  if (!confirm("Reset today's sales & expenses?")) return;
  state.sales = [];
  state.expenses = [];
  state.counters.dailySales = 0;
  state.counters.dailyProfit = 0;
  saveState();
  renderAll();
}

/* ===============================
   INITIAL LOAD
================================ */
document.addEventListener("DOMContentLoaded", () => {
  userRole.innerText = currentRole;
  userName.innerText = currentUser;
  renderAll();
});
</script>

</body>
</html>
